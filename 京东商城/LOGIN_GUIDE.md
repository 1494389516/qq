# 京东登录指南

本指南详细说明如何正确配置和使用京东爬虫的登录功能，包括登录失败时的解决方案。

## 登录方式

京东爬虫支持两种登录方式：

### 1. 扫码登录（推荐）

扫码登录是最简单可靠的方法，无需提供账号密码：

```bash
python run_jd_spider.py --url "https://item.jd.com/商品ID.html" --login
```

程序会自动：
1. 打开京东登录页面
2. 显示并保存二维码图片（`jd_qrcode.png`）
3. 等待您用手机京东APP扫码并确认
4. 检测到登录成功后保存cookies
5. 继续爬取商品信息

**注意事项**：
- 二维码有效期仅为**1分钟**，请尽快扫描
- 扫码后请在手机上点击"确认登录"
- 如果二维码过期，程序会自动刷新（除非禁用了自动刷新）

### 2. 账号密码登录

如果您偏好使用账号密码登录：

```bash
python run_jd_spider.py --url "https://item.jd.com/商品ID.html" --login --username "账号" --password "密码"
```

**注意事项**：
- 账号可以是京东账号、手机号或邮箱
- 可能需要手动处理验证码（包括滑块验证）
- 不建议频繁使用账号密码登录，以免触发风控

## Cookie管理

### 保存位置

登录成功后，程序会自动保存cookies到`cookies/`目录：

```
cookies/
├── 用户名1.pkl    # pickle格式的Cookie数据
├── 用户名1.json   # 可读格式的Cookie数据（调试用）
├── 用户名2.pkl
└── 用户名2.json
```

### Cookie自动加载

重新运行程序时，会自动检测和加载有效的cookies：

1. 程序首先检查`cookies/`目录下是否有可用cookie
2. 验证cookie是否有效，如有效则直接使用
3. 无效则删除旧cookie并提示重新登录

### 手动管理Cookie

如果需要切换账号或强制重新登录：

1. 删除`cookies/`目录下对应的`.pkl`和`.json`文件
2. 或删除整个`cookies/`目录（将会自动重新创建）
3. 重新运行程序并使用`--login`参数

## 登录状态验证

程序使用多种方法验证登录状态：

1. 检查页面元素（用户名显示）
2. 分析页面内容（登录状态指示）
3. 使用JavaScript检测登录状态
4. 验证cookie有效性

## 常见问题解决方案

### 1. 扫码成功但程序未检测到登录

可能原因：
- 页面重定向导致登录状态丢失
- 网络延迟导致状态更新不及时
- 京东的登录验证机制变化

解决方法：
- 使用`--debug`参数运行程序，查看详细日志
- 确认扫码后手机上是否点击了"确认登录"
- 尝试重新登录，等待更长时间让登录状态稳定
- 检查是否使用了代理或VPN（可能影响登录）

### 2. 登录成功但无法保存Cookie

可能原因：
- `cookies/`目录权限不足
- 程序在保存cookie前被中断
- cookie保存逻辑失败

解决方法：
- 确保程序有权限创建和写入`cookies/`目录
- 登录成功后让程序继续运行至少5秒
- 使用`--debug`参数运行，查看cookie保存是否有错误日志

### 3. Cookie已保存但下次运行仍需登录

可能原因：
- cookie已过期（京东cookie有效期较短）
- cookie保存不完整或格式错误
- 京东检测到异常登录行为

解决方法：
- 检查`cookies/`目录下的`.json`文件看cookie是否完整
- 删除现有cookie文件，重新登录
- 尝试使用扫码登录代替账号密码登录

### 4. 登录后页面跳转，没有返回商品页

可能原因：
- 原始URL保存失败
- 重定向处理逻辑失败

解决方法：
- 使用最新版本的爬虫程序
- 登录前确保已成功加载商品页面
- 手动将商品URL复制保存，登录成功后自行访问

### 5. 账号被风控或限制

可能原因：
- 短时间内频繁登录尝试
- 账号存在异常行为
- IP地址被京东标记为高风险

解决方法：
- 减少登录频率，使用已保存的cookie
- 尝试使用其他账号登录
- 等待一段时间（数小时或数天）后再尝试
- 确认账号不存在安全问题

## 高级提示

### 最佳实践

1. 优先使用扫码登录，登录成功率更高
2. 商品爬取前先确保登录状态可用
3. 一次登录后，尽量在cookie有效期内完成爬取
4. 登录成功后，备份cookies目录以便后续使用

### 安全提示

1. 不要将保存的cookie文件共享给他人
2. 不要在公共或不安全的环境中使用账号密码登录
3. 定期检查京东账号的安全设置
4. 如发现账号异常，请立即修改密码 